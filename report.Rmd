---
title: "**Help! I've Fallen and I Can't Get Up: A Report**"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
```

*Note: The title of this project is a line from a commercial that has been [memed](https://www.google.com/search?q=life+alert+meme&sxsrf=ACYBGNQqIvW74KMRbdauXsERsqWnXo-X_Q:1575226120265&source=lnms&tbm=isch&sa=X&ved=2ahUKEwiWjdvKjpXmAhVHq1kKHccFBD8Q_AUoAXoECAsQAw&biw=1130&bih=1257) and is often the subject of jokes. It is in no way meant to trivialize the emergencies experienced by 911 callers or the work of EMS responders. 




## **Motivation and Project Goals**

In New York City, emergencies abound. It’s hard to imagine a day in New York without the sound of wailing sirens and flashing emergency vehicle lights. 

It is expected that when it comes to emergency medical services (EMS), faster is better. Most EMS operations aim to have a response time of 8 minute or less for advanced life support (ALS) units responding to life-threatening events.

In 2018, it was estimated that [~46 percent of ambulance responses to serious emergencies took longer than 10 minutes in NYC](https://cbcny.org/research/reviving-ems). The City of New York spends more than [$1.1 billion annually to provide EMS services](https://council.nyc.gov/budget/wp-content/uploads/sites/54/2018/03/FY19-Fire-Department-of-New-York.pdf) to the city, however the money is often not used wisely. Conflicting reports claiming that an 8 minute or less response time may not improve health outcomes call into question whether a response time <8 min is important and if we should we allocate more funds to reduce NYC response times.

This study seeks to assess the association between NYC EMS response time and mortality.




## **Related Work/Inspiration**
When thinking about the direction for our project, our group considered past years' projects to help create an image of our end product. In looking at these projects, we found that a lot of groups focused on local, NYC-based phenomena. We thought it would be great to take a deeper look at the city that is our home. 

Multiple data sources were considered, but the choice to examine Emergency Medical Services was unanimous and immediate. We tapped into our knowledge from the Core and immediately thought of the differences in health determinants, infrastructure, and accessibility between Manhattan neighborhoods. 



## **Initial Questions**
After a very preliminary glance at the data set, some of the proposed questions were:

* Do different types of EMS calls get treated differently?
* Are response times different for different types of calls?
* Do response times vary by borough, zip code, or neighborhood?
* Could geographical resources and income associated with neighborhoods be associated with response time?

We wanted to examine a possible relationship between socio-economic status (SES) and response time/clinical outcome. However, finding a good proxy for SES proved to be difficult. Variables we considered were annual income, monthly rent, education, or occupation. In the end, we didn't feel that any of these could very accurately represent SES, and that even within neighborhoods that are typically "wealthy" or "poor", outliers or unreliable data would likely skew the results. Data for these variables was hard to find. For the data we did find, we were not confident that the data sources for these variables were completely accurate due to unreliable reporting methods.

We wanted to examine whether there were points in the FDNY EMS Response system that may be vulnerable to bias or mistakes, where further research could shape interventions to improve emergency responses.  Thus, we decided to explore the relationships between neighborhood, response time, and clinical outcome, posing the following questions:

* Do clinical outcomes differ by neighborhood?
* Do clinical outcomes vary depending on the nature of the emergency?
* Does response time vary depending on the nature of the emergency?
* Does response time differ by neighborhood?

Later on, due to computing restraints, we limited our analysis to the borough of Manhattan. We all have a personal connection to Manhattan as we live and go to school here, and we felt that it has a very diverse range of neighborhoods. 



## **Data**
The data source for this project comes from the [NYC EMS Incident Dispatch Data](https://data.cityofnewyork.us/Public-Safety/EMS-Incident-Dispatch-Data/76xm-jjuj), owned by NYCOpenData and provided by the Fire Department of New York City.

The EMS Incident Dispatch Data is generated by the FDNY EMS Computer Aided Dispatch System. The data spans from the time an incident is created in the system to the time that incident is closed. 

For every call/emergency in the system from the start of 2013 to the end of 2018, the database contains information on the following components: 

* Time (initial, closing)

* Call/emergency type (initial, closing, severity)

* Location (borough, dispatch area, zip code, precinct, district (city council, community, school, congressional))

* Response time (incident, dispatch)

As well as some internal quality control measures. 

As noted, to protect personal identifying information in accordance with the Health Insurance Portability and Accountability Act (HIPAA), specific locations of incidents are not included and have been aggregated to a higher level of detail.

Additionally, for the assignment of neighborhood by zip code, we used the [New York State Department of Health ZIP Code Definitions of New York City Neighborhoods](https://www.health.ny.gov/statistics/cancer/registry/appendix/neighborhoods.htm).

### Cleaning
The original dataset contains 8.56 million rows of data, spanning across 5 years. 
Due to computing restraints, we narrowed down the dataset before cleaning it in RStudio. We applied the following constraints to the dataset:

* Borough: Manhattan
* Year: 2018
* Valid incident response time (quality control)
* Only non-cancelled calls
* No duplicate calls
* Only calls where EMS was dispatched
* Only calls where the final clinical outcome was not missing or unknown

After we limited the data set, data cleaning steps included separating the date and time variables, recoding relevant variables as factors, creating a clinical outcome variable regarding living status, creating a neighborhood variable based on zip code, and excluding missing values. 

## **Exploratory analysis**

Our exploratory analysis focused on two outcomes of interest: 

* Death upon arrival of EMS Response Team

* Response time

During our exploration, we sought to find any differences in these outcomes depending on neighborhood, and whether these outcomes were independent of each other. 
Initially, we conducted the exploratory analysis using the zip codes originally found in the NYC OpenData dataset, but felt that this was inaccessible and produced hard-to-read graphs. Thus, we used the NYS standardized neighborhoods to make our results more coherent and understandable. 

Additionally, we decided to explore whether these outcomes varied by the time of year, and whether there was a difference in the types of emergencies in each neighborhood. We felt that visual, interactive tools were the easiest way for us to see the data. Below are figures that summarize the inter-relationships of our main variables of focus: 

```{r, include = FALSE}
library(tidyverse)
library(patchwork)
library(plotly)

ems_data_clean = read.csv("./data/EMS_Incident_Dispatch_Data.csv") %>%
  select(INITIAL_SEVERITY_LEVEL_CODE, FINAL_SEVERITY_LEVEL_CODE, INITIAL_CALL_TYPE,
         DISPATCH_RESPONSE_SECONDS_QY, INCIDENT_TRAVEL_TM_SECONDS_QY, HELD_INDICATOR, BOROUGH,
         ZIPCODE, INCIDENT_DISPOSITION_CODE, INCIDENT_DATETIME) %>% 
  janitor::clean_names() %>% 
  separate(col = incident_datetime, into = c('date', 'time'), sep = ' ') %>% 
  separate(col = date, into = c("month","day"), sep = '/') %>% 
  mutate(month = factor(month, levels = c("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"), labels = c("Jan", "Feb", "Mar", "Apr", "May", "June", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"), ordered = TRUE)) %>% 
  mutate(arrival_outcome = ifelse(incident_disposition_code == "83", "dead", "alive"),
         arrival_outcome = recode_factor(arrival_outcome, `0` = "alive", `1` = "dead"),
         initial_severity_level_code = factor(initial_severity_level_code, 
 levels = c("1", "2","3", "4", "5", "6", "7", "8", "9"), ordered = TRUE),
         final_severity_level_code = factor(final_severity_level_code, 
                                            levels = c("1", "2", "3", "4", "5", "6", "7", "8"), ordered = TRUE), 
         held_indicator = recode(held_indicator, "N" = "no", "Y" = "yes")) %>%
  mutate(neighbourhood = recode(zipcode, "10026" = "central harlem", "10027" = "central harlem", "10030" = "central harlem", "10037" = "central harlem", "10039" = "central harlem", "10001" = "chelsea and clinton", "10001" = "chelsea and clinton", "10011" = "chelsea and clinton", "10018" = "chelsea and clinton", "10019" = "chelsea and clinton", "10020" = "chelsea and clinton", "10036" = "chelsea and clinton",  "10029" = "east harlem", "10035" = "east harlem", "10010" = "gramercy park and murray hill", "10016" = "gramercy park and murray hill", "10017" = "gramercy park and murray hill", "10022" = "gramercy park and murray hill", "10012" = "greenwich village and soho", "10013" = "greenwich village and soho", "10014" = "greenwich village and soho", "10004" = "lower manhattan", "10005" = "lower manhattan", "10006" = "lower manhattan", "10007" = "lower manhattan", "10038" = "lower manhattan", "10280" = "lower manhattan", "10002" = "lower east side", "10003" = "lower east side", "10009" = "lower east side", "10021" = "upper east side", "10028" = "upper east side", "10044" = "upper east side", "10065" = "upper east side", "10075" = "upper east side", "10128" = "upper east side", "10023" = "upper west side", "10024" = "upper west side", "10025" = "upper west side", "10031" = "inwood and washington heights", "10032" = "inwood and washington heights", "10033" = "inwood and washington heights", "10034" = "inwood and washington heights", "10040" = "inwood and washington heights" )
  ) %>%  
  drop_na(neighbourhood) %>% 
    select(-incident_disposition_code) 
```
```{r, warning = FALSE}
ems_data_clean %>% 
  select(arrival_outcome, month) %>% 
  group_by(month, arrival_outcome) %>%
  drop_na(arrival_outcome) %>% 
  summarise_(n = ~n()) %>%
  filter(arrival_outcome == "dead") %>% 
  plot_ly(y = ~n, x = ~month, type = "bar",
          color = ~month, alpha = 0.7) %>% 
  layout(title = "Death Count on Arrival for each Month in 2018",
    xaxis = list(title = "Month"),
         yaxis = list(title = 'Dead on Arrival (n)'),
    showlegend = FALSE)


ems_data_clean %>% 
  select(arrival_outcome, neighbourhood) %>% 
  group_by(neighbourhood, arrival_outcome) %>%
  drop_na(arrival_outcome) %>% 
  summarise_(n = ~n()) %>%
  filter(arrival_outcome == "dead") %>% 
  plot_ly(y = ~n, x = ~neighbourhood, type = "bar",
          color = ~neighbourhood) %>% 
  layout(title = "Death Count on Arrival by NYC Neighborhood",
    xaxis = list(title = "Neighborhood"),
         yaxis = list(title = 'Dead on Arrival (n)'),
    showlegend = FALSE)

deaths_scatter = ems_data_clean %>%
select(arrival_outcome, neighbourhood, month) %>%
group_by(arrival_outcome, neighbourhood, month) %>% 
drop_na(arrival_outcome) %>% 
summarise_(n_death = ~n()) %>%
filter(arrival_outcome %in% "dead") %>%
plot_ly(x = ~month, y = ~n_death, color = ~neighbourhood,type = "scatter", mode = "lines+markers", alpha = 0.5) %>%
  layout(title = 'Death Count on Arrival by NYC Neighborhood Over Time, 2018',
    xaxis = list(title = 'Month'),
         yaxis = list(title = 'Dead on Arrival (n)'),
         legend = list(x = 100, y = 0.5))
deaths_scatter

ems_data_clean %>% 
  select(arrival_outcome, incident_travel_tm_seconds_qy) %>% 
  group_by(arrival_outcome) %>% 
  drop_na(arrival_outcome) %>%
  summarize(mean_time = mean(incident_travel_tm_seconds_qy))

time_boro = ems_data_clean %>%
  select(neighbourhood, arrival_outcome, incident_travel_tm_seconds_qy) %>%
  group_by(arrival_outcome, neighbourhood) %>%
  drop_na(arrival_outcome) %>%
  summarize(mean_time = mean(incident_travel_tm_seconds_qy)) %>% 
  plot_ly(x = ~neighbourhood, y = ~mean_time/60, color = ~arrival_outcome, group = ~arrival_outcome, type = "bar", colors = "Set2") %>% 
  layout(title = "Mean Travel Time by NYC Neighborhood",
    xaxis = list(title = "Neighborhood"),
         yaxis = list(title = 'Mean EMS Travel Time (min)'),
    showlegend = FALSE)
time_boro

ems_data_clean %>%
  select(neighbourhood, initial_severity_level_code, incident_travel_tm_seconds_qy) %>%
  group_by(neighbourhood, initial_severity_level_code) %>% 
  summarize(mean_time = mean(incident_travel_tm_seconds_qy)) %>%
  plot_ly(x = ~initial_severity_level_code, y = ~mean_time/60, group = ~neighbourhood, color = ~neighbourhood, type = "scatter", mode = "lines+markers", alpha = 0.5) %>% 
  layout(title = "Mean Travel Time by Severity for each Neighborhood",
    xaxis = list(title = "Severity Code"),
         yaxis = list(title = "Mean Travel Time (min)"),
         legend = list(x = 100, y = 0.5))
```





### Death Counts by Month
There seems to be a slight seasonal trend in the number of those who are deceased upon arrival of the EMS Response Team, with peaks during the summer and winter. There was a 34% decrease in the number of deaths between January, the month with the most, and September, the month with the least. 




## **Statistical analysis**






## **Results & Discussion**

The data seem to suggests a seasonal trend in the number of individuals deceased upon arrival of EMS Response Teams. However, it is unclear whether this trend is consistent from year-to-year. 


### Strengths & Limitations

Our study was able to efficiently and clearly assess the relationship between 

One of the biggest limitations of our study is that the data did not contain a variable indicating the type of response unit sent. The FDNY is in command of many different response units, which all correspond to different types of emergencies.

Additionally, the data is only recorded once the incident is created in the FDNY system. If you’ve ever called 911 (hopefully you haven’t had to), you’ll know that the first person you talk to is not a police officer, emergency medical technician, or fire fighter. It’s a 911 Call Taker, as shown by this schematic provided by [NYC Analytics](http://home2.nyc.gov/html/911reporting/html/anatomy/call.shtml). These call takers ask tons of questions, the most notable being “What’s your emergency” to assess the appropriate emergency response team for the situation. A police officer may not be as helpful as a firefighter for a building fire.

After the dispatcher determines the best response team for the emergency, they will either put you directly in contact with someone from say, the fire department or police, or they will pass the information along to them while they stay on the line with you. (In the NYC Analytics [schematic](http://home2.nyc.gov/html/911reporting/html/anatomy/call.shtml), this is shown under FDNY EMS VESTA in Orange as 911 Call Conference). Then, either the caller or call taker may have to relay the pertinent information to the response team dispatcher.

Our data is collected only after the first 911 call taker has passed the call along to the FDNY EMS (Incident creation in the [schematic](http://home2.nyc.gov/html/911reporting/html/anatomy/call.shtml)). Thus, it does not include the amount of time the caller spent explaining their emergency to the dispatcher before being transferred to the FDNY. In many cases, this can be a lengthy process, but from our data it is impossible to tell. Additionally, it is unclear from the data whether, from the NYC Analytics schematic, whether our incident creation is at the general incident creation between “Call Taking” and “Skip to Dispatch” in yellow at the top, or the “EMS Incident Creation” between “911 Call Conference” and “Dispatch Queue” in orange at the bottom of the schematic.

911 calls are emergencies, so time is crucial. The time before the incident is created could influence not only the resulting morbidity or mortality of those involved in the emergencies, it could also influence the amount of time the FDNY spends on the phone before a unit is dispatched. For example, if the 911 caller is in some way incapacitated, the initial call taker may have difficulties assessing the emergency and identifying the appropriate response team. The FDNY EMS dispatcher may also then have difficulties assessing what type of unit to send, or even where to send the unit.

As a result, the data provide indications of the efficiency of the EMS Response Teams in each neighborhood, but not necessarily the safety or other inherent traits thereof. 

Another limitation to our data is that it was only collected from 2018. Amid political unrest regarding our current President and his legal affairs, Supreme Court Judge pick, and immigration policies; unhappiness with NYC's current mayor; and mass shootings rocking the nation, this year could have seen an increase in violent crime or substance abuse, skewing the results. Conversely, compared to the election year of 2016, crime and substance abuse could have dropped significantly. We cannot extrapolate our findings to years past or present.

### **Conclusion**

The distributions of those deceased upon arrival of EMS Response Teams and travel time may be affected by a number of external factors. Future research comparing political climate, extreme weather, or local cultural events to multiple years of data may provide more insight into the reasoning for the variation seen in our data. 




